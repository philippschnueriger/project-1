<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>To DoApp</title>
    <link rel="stylesheet" type="text/css" href="./main.css">
  </head>
  <body>
    <main>
        <div class="overview">
            <div class="menu">
                <button class="switch-view">Create new todo</button>
                <button type="button" id="theme-button">Toggle Style</button>
            </div>
            <div class="filter">
                <div>
                    <button type="button" id="name-button">Name</button>
                    <button>By Due Date</button>
                    <button type="button" id="created-button">By Creation Date</button>
                    <button type="button" id="importance-button">By Importance</button>
                </div>
                <button type="button" id="status-button">Filter Completed</button>
            </div>
            <ul id="todos"></ul>
        </div>
        <div class="new-entry hide">
            <form id="form" action="./index.html" action="POST">
                <label for="title">Title</label>
                <input id="title" type="text" name="title" />

                <label for="importance">Importance</label>
                <input id="importance" type="text" name="importance" />

                <label for="duedate">Duedate</label>
                <input id="duedate" type="date" name="duedate" />

                <input id="status"type="checkbox">Finished</input><br />

                <label for="description">Description</label>
                <textarea id="description" name="description"></textarea>
                <div class="menu">
                    <button>Create</button>
                    <button class="switch-view">Create & Overview</button>
                    <button class="switch-view" >Overview</button>
                </div>
              </form>
        </div>
    </main>
    <script src="./main.js" defer></script>
    <script type="module">
        import todoStore from "./todo-store.js"

        const todos = todoStore.todos;
        let sortedTodos = todos;
        let filteredTodos = todos;
        const songListElement = document.querySelector("#todos");
        
        function createSongsHtml(todos) {
            return todos.map(todo =>
            `<li>
                <div class="status">
                    <div class="due-date">${todo.duedate}</div>
                    <input type="checkbox">${todo.status}</input>
                </div>
                <div class="content">
                    <div class="name">${todo.name}</div>
                    <div class="description">${todo.description}</div>
                </div>
                <div class="rating">
                    <div class="importance">${todo.priority}</div>
                </div>
                <div class="edit">
                    <button>Edit</button>
                </div>
            </li>`).join('');
        }

        const sortType = {
                "string": (a, b) => a > b ? 1 : a < b ? -1 : 0,
                "number": (a, b) => a - b,
                "date": (a, b) => Date(b) - Date(a),
            }

        function filterItemsBy(items, filter) {
            if (filteredTodos === todos) {
                filteredTodos = items.filter(todo => todo.status === true);
                return filteredTodos;
            } else {
                return todos;
            }
        }

        function sortItemsBy(items, sort) {
            const sortFn = sortType[typeof (items[0][sort])];
            return [...items].sort((a, b) => sortFn(a[sort], b[sort]));
        }

        const nameButton = document.getElementById("name-button");
        nameButton.addEventListener("click", () => {
            sortedTodos = sortItemsBy(todos, "name");
            renderTodos(sortedTodos);
        });
        const createdButton = document.getElementById("created-button");
        createdButton.addEventListener("click", () => {
            sortedTodos = sortItemsBy(todos, "created");
            renderTodos(sortedTodos);
        });
        const importanceButton = document.getElementById("importance-button");
        importanceButton.addEventListener("click", () => {
            sortedTodos = sortItemsBy(todos, "priority");
            renderTodos(sortedTodos);
        });
        const statusButton = document.getElementById("status-button");
        statusButton.addEventListener("click", () => {
            filteredTodos = filterItemsBy(todos, "status");
            renderTodos(filteredTodos);
        });

        function renderTodos(todos){
            songListElement.innerHTML = createSongsHtml(todos);
        }
        renderTodos(todos)
    </script>
  </body>
</html>
